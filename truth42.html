<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Truth42 - Forensic Analysis</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            font-family: 'Inter', system-ui, -apple-system, sans-serif; 
            background-color: #0b1121; /* Darker Navy/Slate */
            color: #e2e8f0; 
        }
        
        /* Refined Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0b1121; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        .glass-panel {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        .btn-glow:hover:not(:disabled) {
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
        }

        /* Loading Bar Animation */
        @keyframes loadProgress {
            0% { width: 0%; }
            10% { width: 10%; }
            40% { width: 40%; }
            70% { width: 70%; }
            90% { width: 85%; }
            100% { width: 100%; }
        }

        .animate-progress {
            animation: loadProgress 2.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        
        .drag-active {
            border-color: #818cf8 !important;
            background: rgba(99, 102, 241, 0.15) !important;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden selection:bg-indigo-500/30">

    <!-- Compact Header -->
    <nav class="w-full bg-[#0f172a]/90 border-b border-slate-800/60 px-6 py-3 flex justify-between items-center z-50 shrink-0 backdrop-blur-sm">
        <div class="flex items-center gap-3">
            <div class="p-1.5 bg-indigo-500/10 rounded-md border border-indigo-500/20">
                <svg class="w-5 h-5 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <h1 class="text-lg font-semibold tracking-tight text-white">Truth42 <span class="text-slate-500 font-normal text-sm ml-2">| AI Forensics</span></h1>
        </div>
        <div class="flex items-center gap-3 text-xs font-mono text-slate-500">
            <span class="hidden sm:inline">Gemini 2.5 Flash</span>
            <span class="w-2 h-2 rounded-full bg-green-500/80 shadow-[0_0_10px_rgba(34,197,94,0.4)] animate-pulse"></span>
        </div>
    </nav>

    <!-- Main Workspace -->
    <main class="flex-1 relative flex overflow-hidden">
        
        <!-- Left Panel: Upload & Preview -->
        <div class="flex-1 flex flex-col p-4 md:p-6 overflow-y-auto custom-scrollbar relative z-10 transition-all duration-500" id="left-panel">
            
            <div class="max-w-xl mx-auto w-full flex flex-col h-full justify-center">
                
                <!-- Compact Upload Zone -->
                <div id="drop-zone" class="glass-panel rounded-xl border border-dashed border-slate-600/50 p-6 text-center cursor-pointer transition-all duration-300 hover:border-indigo-400/50 hover:bg-slate-800/30 group relative overflow-hidden min-h-[160px] flex flex-col justify-center items-center">
                    
                    <input type="file" id="file-input" class="hidden" accept="image/png, image/jpeg, image/webp">
                    
                    <!-- Initial State Content -->
                    <div id="upload-prompt" class="space-y-3 pointer-events-none transition-opacity duration-300">
                        <div class="w-12 h-12 bg-slate-800/50 rounded-xl flex items-center justify-center mx-auto group-hover:scale-110 group-hover:bg-slate-800 transition-all border border-slate-700/50 group-hover:border-indigo-500/30 shadow-lg">
                            <svg class="w-6 h-6 text-indigo-400/80" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-slate-200 group-hover:text-indigo-300 transition-colors">Click or Drop Image</p>
                            <p class="text-[10px] uppercase tracking-widest text-slate-500 mt-1">JPG • PNG • WEBP</p>
                        </div>
                    </div>

                    <!-- Preview State -->
                    <div id="preview-container" class="hidden absolute inset-0 bg-[#0b1121] flex flex-col items-center justify-center z-20">
                        <div class="relative w-full h-full p-1">
                            <img id="image-preview" class="w-full h-full object-contain rounded-lg opacity-0 transition-opacity duration-500" src="" alt="Preview">
                            
                            <!-- Remove Button -->
                            <button onclick="resetUpload(event)" class="absolute top-3 right-3 bg-black/40 hover:bg-red-500/80 text-white p-2 rounded-lg backdrop-blur-md border border-white/10 transition-all hover:scale-105 shadow-lg group/btn" title="Remove">
                                <svg class="w-4 h-4 text-white/70 group-hover/btn:text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Action Area -->
                <div class="mt-6 transition-all duration-300 opacity-0 translate-y-2" id="action-bar">
                    <div class="flex justify-between items-center mb-3 px-1">
                        <div class="text-xs font-mono text-indigo-300/60 truncate max-w-[250px]" id="filename-display">image.jpg</div>
                        <div class="text-xs text-slate-500 transition-colors duration-300" id="status-text">Ready to scan</div>
                    </div>

                    <!-- Button Container -->
                    <div class="relative h-12 w-full">
                        <!-- Scan Button -->
                        <button id="analyze-btn" onclick="handleAnalysis()" disabled
                            class="btn-glow absolute inset-0 w-full h-full bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-500 hover:to-violet-500 text-white text-sm font-semibold rounded-lg shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2 z-20">
                            <span>Run Forensic Scan</span>
                            <svg class="w-4 h-4 opacity-70" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                        </button>

                        <!-- Progress Bar Container -->
                        <div id="progress-container" class="hidden absolute inset-0 w-full h-full bg-slate-800 rounded-lg overflow-hidden border border-slate-700 z-10">
                            <div id="progress-fill" class="h-full bg-gradient-to-r from-indigo-600 to-blue-500 w-0 transition-all"></div>
                            <div class="absolute inset-0 flex items-center justify-center text-xs font-bold uppercase tracking-widest text-white mix-blend-overlay">
                                Analyzing Artifacts...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Panel: Results -->
        <div id="output-panel" class="w-0 overflow-hidden bg-[#0b1121] border-l border-slate-800/50 transition-[width] duration-500 ease-[cubic-bezier(0.16,1,0.3,1)] shadow-2xl">
            <div class="w-[400px] md:w-[450px] h-full flex flex-col p-6 overflow-y-auto">
                
                <div class="mb-6 pb-6 border-b border-slate-800/50">
                    <h2 class="text-lg font-semibold text-white mb-1">Analysis Report</h2>
                    <p class="text-xs text-slate-500">Forensic breakdown of visual artifacts</p>
                </div>

                <!-- Score Card -->
                <div class="glass-panel rounded-xl p-5 mb-6 relative overflow-hidden">
                    <div id="score-glow" class="absolute -top-10 -right-10 w-32 h-32 bg-indigo-500/20 blur-3xl rounded-full transition-colors duration-1000"></div>

                    <div class="flex justify-between items-end mb-3 relative z-10">
                        <span class="text-[10px] font-bold font-mono text-slate-400 uppercase tracking-widest">AI Probability</span>
                        <span id="score-display" class="text-3xl font-bold text-white tracking-tighter">0%</span>
                    </div>
                    
                    <div class="w-full bg-slate-900/50 h-1.5 rounded-full overflow-hidden relative z-10">
                        <div id="score-bar" class="h-full bg-indigo-500 rounded-full transition-all duration-1000 w-0 shadow-[0_0_10px_rgba(99,102,241,0.5)]"></div>
                    </div>
                    
                    <div id="verdict-badge" class="mt-4 text-center text-xs font-bold uppercase py-2 rounded-lg bg-slate-800/50 border border-slate-700/50 text-slate-400 relative z-10 transition-colors duration-500">
                        Waiting for input
                    </div>
                </div>

                <!-- Reasoning -->
                <div class="space-y-6">
                    <div>
                        <h3 class="text-[10px] font-bold text-indigo-400 uppercase tracking-widest mb-3 flex items-center gap-2">
                            <div class="w-1 h-1 bg-indigo-400 rounded-full"></div>
                            Forensic Reasoning
                        </h3>
                        <p id="reasoning-text" class="text-sm text-slate-300 leading-relaxed bg-slate-800/30 p-4 rounded-lg border border-slate-700/30 shadow-inner">
                            No data available.
                        </p>
                    </div>

                    <div>
                        <h3 class="text-[10px] font-bold text-red-400 uppercase tracking-widest mb-3 flex items-center gap-2">
                            <div class="w-1 h-1 bg-red-400 rounded-full"></div>
                            Detected Anomalies
                        </h3>
                        <ul id="suspicious-list" class="space-y-2">
                            <li class="text-xs text-slate-500 italic pl-1">Awaiting analysis scan...</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        // =======================================================
        // ⚠️ CRITICAL: PASTE YOUR API KEY BELOW ⚠️
        // =======================================================
        const apiKey = ""; 
        // Example: "AIzaSy..."
        // =======================================================
        
        const API_MODEL = 'gemini-2.5-flash-preview-09-2025'; 
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${API_MODEL}:generateContent?key=${apiKey}`;

        // STATE & DOM
        let currentBase64 = null;
        let currentMimeType = null;
        
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const uploadPrompt = document.getElementById('upload-prompt');
        const previewContainer = document.getElementById('preview-container');
        const imagePreview = document.getElementById('image-preview');
        const actionBar = document.getElementById('action-bar');
        const filenameDisplay = document.getElementById('filename-display');
        const statusText = document.getElementById('status-text');
        const analyzeBtn = document.getElementById('analyze-btn');
        const progressContainer = document.getElementById('progress-container');
        const progressFill = document.getElementById('progress-fill');
        const outputPanel = document.getElementById('output-panel');
        const leftPanel = document.getElementById('left-panel');
        
        const scoreBar = document.getElementById('score-bar');
        const scoreDisplay = document.getElementById('score-display');
        const scoreGlow = document.getElementById('score-glow');
        const verdictBadge = document.getElementById('verdict-badge');
        const reasoningText = document.getElementById('reasoning-text');
        const suspiciousList = document.getElementById('suspicious-list');

        // DRAG & DROP
        dropZone.addEventListener('click', (e) => { if(!currentBase64) fileInput.click(); });
        ['dragenter', 'dragover'].forEach(e => dropZone.addEventListener(e, (ev) => { ev.preventDefault(); dropZone.classList.add('drag-active'); }));
        ['dragleave', 'drop'].forEach(e => dropZone.addEventListener(e, (ev) => { ev.preventDefault(); dropZone.classList.remove('drag-active'); }));
        dropZone.addEventListener('drop', (e) => { if (e.dataTransfer.files.length) processFile(e.dataTransfer.files[0]); });
        fileInput.addEventListener('change', (e) => { if (e.target.files.length) processFile(e.target.files[0]); });

        function processFile(file) {
            if (!file.type.startsWith('image/')) { alert('Please upload a valid image (JPG, PNG, WEBP).'); return; }
            closeResults();
            const reader = new FileReader();
            reader.onload = (e) => {
                currentBase64 = e.target.result.split(',')[1]; 
                currentMimeType = file.type;
                imagePreview.src = e.target.result;
                filenameDisplay.textContent = file.name;
                statusText.textContent = "Ready to scan";
                statusText.classList.remove('text-red-400');
                
                uploadPrompt.classList.add('opacity-0');
                setTimeout(() => uploadPrompt.classList.add('hidden'), 300);
                previewContainer.classList.remove('hidden');
                setTimeout(() => imagePreview.classList.remove('opacity-0'), 50);
                actionBar.classList.remove('opacity-0', 'translate-y-2');
                analyzeBtn.disabled = false;
            };
            reader.readAsDataURL(file);
        }

        function resetUpload(e) {
            if(e) e.stopPropagation();
            currentBase64 = null;
            fileInput.value = '';
            closeResults();
            imagePreview.classList.add('opacity-0');
            setTimeout(() => {
                previewContainer.classList.add('hidden');
                uploadPrompt.classList.remove('hidden');
                setTimeout(() => uploadPrompt.classList.remove('opacity-0'), 50);
            }, 300);
            actionBar.classList.add('opacity-0', 'translate-y-2');
            analyzeBtn.disabled = true;
            analyzeBtn.classList.remove('hidden');
            progressContainer.classList.add('hidden');
            progressFill.classList.remove('animate-progress');
        }

        function openResults() {
            if (window.innerWidth >= 768) {
                outputPanel.style.width = '450px';
            } else {
                outputPanel.style.width = '100%';
                leftPanel.style.display = 'none'; 
            }
        }

        function closeResults() {
            outputPanel.style.width = '0';
            leftPanel.style.display = 'flex';
            scoreBar.style.width = '0%';
            scoreDisplay.textContent = '0%';
            verdictBadge.textContent = 'WAITING FOR INPUT';
            reasoningText.textContent = 'No data available.';
            suspiciousList.innerHTML = '<li class="text-xs text-slate-500 italic pl-1">Awaiting analysis scan...</li>';
        }

        // ANALYSIS
        const SYSTEM_PROMPT = `Expert AI Forensics Analyst. Analyze image for AI generation. Check Textures, Anatomy, Physics, Digital Noise. Output JSON: { "score": (0-100), "verdict": "Short Status", "reasoning": "Concise explanation.", "flags": ["Point 1", "Point 2"] }`;

        async function handleAnalysis() {
            if (!currentBase64) return;
            
            // 1. SHOW LOADING STATE IMMEDIATELY
            analyzeBtn.classList.add('hidden'); 
            progressContainer.classList.remove('hidden'); 
            progressFill.classList.add('animate-progress'); 
            statusText.textContent = "Initializing...";
            
            // Delay to let UI paint
            await new Promise(r => setTimeout(r, 600));

            // 2. CHECK API KEY AFTER UI UPDATE
            if (!apiKey || apiKey === "") {
                progressContainer.classList.add('hidden');
                progressFill.classList.remove('animate-progress');
                analyzeBtn.classList.remove('hidden');
                
                statusText.textContent = "⚠️ Error: API Key Missing";
                statusText.classList.add('text-red-400');
                alert("Setup Required: Please edit the code and paste your Gemini API Key in the 'const apiKey' variable at the bottom.");
                return;
            }

            statusText.textContent = "Scanning artifacts...";
            
            const payload = {
                contents: [{ parts: [{ text: SYSTEM_PROMPT }, { inline_data: { mime_type: currentMimeType, data: currentBase64 } }] }],
                generationConfig: { responseMimeType: "application/json" }
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.error) throw new Error(result.error.message);
                
                const data = JSON.parse(result.candidates[0].content.parts[0].text);
                
                // Finish Animation
                progressFill.style.width = '100%';
                setTimeout(() => {
                    renderResults(data);
                    progressContainer.classList.add('hidden');
                    progressFill.classList.remove('animate-progress');
                    progressFill.style.width = '0';
                    analyzeBtn.classList.remove('hidden');
                    statusText.textContent = "Scan Complete";
                }, 600);

            } catch (error) {
                console.error(error);
                progressContainer.classList.add('hidden');
                analyzeBtn.classList.remove('hidden');
                statusText.textContent = "Analysis Failed";
                statusText.classList.add('text-red-400');
                alert("Error: " + error.message);
            }
        }

        function renderResults(data) {
            openResults();
            setTimeout(() => {
                scoreBar.style.width = `${data.score}%`;
                scoreDisplay.textContent = `${data.score}%`;
                let color = data.score < 20 ? 'bg-emerald-500' : data.score < 60 ? 'bg-amber-500' : 'bg-rose-500';
                let textCol = data.score < 20 ? 'text-emerald-400' : data.score < 60 ? 'text-amber-400' : 'text-rose-400';
                scoreBar.className = `h-full rounded-full transition-all duration-1000 ${color} shadow-[0_0_12px_rgba(255,255,255,0.3)]`;
                scoreDisplay.className = `text-3xl font-bold ${textCol}`;
                verdictBadge.textContent = data.verdict;
            }, 100);
            reasoningText.textContent = data.reasoning;
            suspiciousList.innerHTML = '';
            if(data.flags && data.flags.length) {
                data.flags.forEach(flag => {
                    const li = document.createElement('li');
                    li.className = "flex items-start gap-3 text-xs text-slate-300 p-3 bg-slate-800/40 rounded-md border border-slate-700/30";
                    li.innerHTML = `<span class="w-1.5 h-1.5 mt-1.5 rounded-full bg-rose-400 shrink-0"></span><span>${flag}</span>`;
                    suspiciousList.appendChild(li);
                });
            } else {
                suspiciousList.innerHTML = '<li class="text-xs text-emerald-400 italic p-2">No significant artifacts detected.</li>';
            }
        }
    </script>
</body>
</html>